<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>MyMiniReddit - 首页</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">

<div class="max-w-6xl mx-auto p-6">

    <!-- 顶部导航 -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-orange-300">MyMiniReddit</h1>
            <p class="text-sm text-slate-400 mt-1">一个可以发帖、评论、实时聊天的小社区</p>
        </div>
        <div class="space-x-3">
            {% if username %}
                <span class="text-sm opacity-80">已登录：{{ username }}</span>
                {% if is_admin %}
                    <a href="/admin/inbox"
                       class="px-3 py-1 bg-amber-500/80 rounded text-sm font-semibold">
                        管理中心
                    </a>
                    <a href="/admin/users"
                       class="px-3 py-1 bg-slate-700 rounded text-sm text-amber-200">
                        用户管理
                    </a>
                {% endif %}
                <a href="/post/new"
                   class="px-3 py-1 bg-emerald-500 rounded text-sm font-semibold">
                    发帖
                </a>
                <a href="/logout"
                   class="px-3 py-1 bg-slate-700 rounded text-sm">
                    退出
                </a>
            {% else %}
                <a href="/login"
                   class="px-3 py-1 bg-sky-500 rounded text-sm font-semibold">
                    登录
                </a>
                <a href="/register"
                   class="px-3 py-1 bg-emerald-500 rounded text-sm font-semibold">
                    注册
                </a>
            {% endif %}
        </div>
    </div>

    <!-- 板块 / Topics 区域 -->
    <div class="mb-10">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">板块 / Topics</h2>
            {% if username %}
                <a href="/topic/new"
                   class="px-3 py-1 bg-sky-500 rounded text-sm font-semibold">
                    创建新板块
                </a>
            {% endif %}
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            {% if topics %}
                {% for t in topics %}
                    <a href="/topic/{{ t[0] }}"
                       class="block bg-slate-800/80 rounded-xl p-4 hover:bg-slate-700 transition text-center">
                        <div class="text-lg font-semibold mb-1">{{ t[1] }}</div>
                        <div class="text-xs text-slate-400">点击进入</div>
                    </a>
                {% endfor %}
            {% else %}
                <div class="col-span-4 text-center text-slate-400 py-6">
                    还没有任何板块，用户可以在「创建新板块」提交申请，管理员在管理中心审核通过。
                </div>
            {% endif %}
        </div>
    </div>

    <!-- 帖子列表 -->
    <div>
        <h2 class="text-xl font-bold mb-4">最新帖子</h2>

        <div class="space-y-4">
            {% if posts %}
                {% for p in posts %}
                    <div class="bg-slate-800/80 rounded-xl p-4 hover:bg-slate-700 transition">
                        <div class="flex justify-between items-center mb-1">
                            <a href="/post/{{ p[0] }}" class="text-xl font-semibold hover:underline">
                                {{ p[1] }}
                            </a>
                            <div class="flex items-center gap-2">
                                <span class="text-xs opacity-70">
                                    {% if p[5] %}
                                        <span class="text-emerald-300 mr-1">[{{ p[5] }}]</span>
                                    {% endif %}
                                    by {{ p[4] }} · {{ p[3].strftime('%Y-%m-%d %H:%M') if p[3] else '' }}
                                </span>
                                {% if is_admin %}
                                    <form method="post"
                                        action="/admin/post/{{ p[0] }}/delete"
                                        onsubmit="return confirm('确定要删除这篇帖子吗？');">
                                        <button class="text-xs text-red-400 border border-red-500/50 px-2 py-1 rounded hover:bg-red-500/20">
                                            删帖
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                        <p class="text-sm opacity-80 line-clamp-2">
                            {{ p[2][:160] }}{% if p[2]|length > 160 %}...{% endif %}
                        </p>
                    </div>
                {% endfor %}
            {% else %}
                <div class="text-center text-slate-400 py-8">
                    还没有任何帖子，快去发第一帖吧！
                </div>
            {% endif %}
        </div>
    </div>

</div>

</body>
</html>